THREE.TrackballControls=function(z,y){var p=this;var q={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=z;this.domElement=(y!==undefined)?y:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var i=new THREE.Vector3();var r=q.NONE,k=q.NONE,a=new THREE.Vector3(),n=new THREE.Vector3(),h=new THREE.Vector3(),j=new THREE.Vector2(),u=new THREE.Vector2(),g=0,b=0,c=new THREE.Vector2(),t=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var x={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=function(A){if(typeof this[A.type]=="function"){this[A.type](A)}};this.getMouseOnScreen=function(B,A){return new THREE.Vector2((B-p.screen.offsetLeft)/p.radius*0.5,(A-p.screen.offsetTop)/p.radius*0.5)};this.getMouseProjectionOnBall=function(E,C){var B=new THREE.Vector3((E-p.screen.width*0.5-p.screen.offsetLeft)/p.radius,(p.screen.height*0.5+p.screen.offsetTop-C)/p.radius,0);var D=B.length();if(D>1){B.normalize()}else{B.z=Math.sqrt(1-D*D)}a.copy(p.object.position).sub(p.target);var A=p.object.up.clone().setLength(B.y);A.add(p.object.up.clone().cross(a).setLength(B.x));A.add(a.setLength(B.z));return A};this.rotateCamera=function(){var C=Math.acos(n.dot(h)/n.length()/h.length());if(C){var A=(new THREE.Vector3()).crossVectors(n,h).normalize(),B=new THREE.Quaternion();C*=p.rotateSpeed;B.setFromAxisAngle(A,-C);a.applyQuaternion(B);p.object.up.applyQuaternion(B);h.applyQuaternion(B);if(p.staticMoving){n.copy(h)}else{B.setFromAxisAngle(A,C*(p.dynamicDampingFactor-1));n.applyQuaternion(B)}}};this.zoomCamera=function(){if(r===q.TOUCH_ZOOM){var A=g/b;g=b;a.multiplyScalar(A)}else{var A=1+(u.y-j.y)*p.zoomSpeed;if(A!==1&&A>0){a.multiplyScalar(A);if(p.staticMoving){j.copy(u)}else{j.y+=(u.y-j.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var A=t.clone().sub(c);if(A.lengthSq()){A.multiplyScalar(a.length()*p.panSpeed);var B=a.clone().cross(p.object.up).setLength(A.x);B.add(p.object.up.clone().setLength(A.y));p.object.position.add(B);p.target.add(B);if(p.staticMoving){c=t}else{c.add(A.subVectors(t,c).multiplyScalar(p.dynamicDampingFactor))}}};this.checkDistances=function(){if(!p.noZoom||!p.noPan){if(p.object.position.lengthSq()>p.maxDistance*p.maxDistance){p.object.position.setLength(p.maxDistance)}if(a.lengthSq()<p.minDistance*p.minDistance){p.object.position.addVectors(p.target,a.setLength(p.minDistance))}}};this.update=function(){a.subVectors(p.object.position,p.target);if(!p.noRotate){p.rotateCamera()}if(!p.noZoom){p.zoomCamera()}if(!p.noPan){p.panCamera()}p.object.position.addVectors(p.target,a);p.checkDistances();p.object.lookAt(p.target);if(i.distanceToSquared(p.object.position)>0){p.dispatchEvent(x);i.copy(p.object.position)}};this.reset=function(){r=q.NONE;k=q.NONE;p.target.copy(p.target0);p.object.position.copy(p.position0);p.object.up.copy(p.up0);a.subVectors(p.object.position,p.target);p.object.lookAt(p.target);p.dispatchEvent(x);i.copy(p.object.position)};function f(A){if(p.enabled===false){return}window.removeEventListener("keydown",f);k=r;if(r!==q.NONE){return}else{if(A.keyCode===p.keys[q.ROTATE]&&!p.noRotate){r=q.ROTATE}else{if(A.keyCode===p.keys[q.ZOOM]&&!p.noZoom){r=q.ZOOM}else{if(A.keyCode===p.keys[q.PAN]&&!p.noPan){r=q.PAN}}}}}function d(A){if(p.enabled===false){return}r=k;window.addEventListener("keydown",f,false)}function m(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();if(r===q.NONE){r=A.button}if(r===q.ROTATE&&!p.noRotate){n=h=p.getMouseProjectionOnBall(A.clientX,A.clientY)}else{if(r===q.ZOOM&&!p.noZoom){j=u=p.getMouseOnScreen(A.clientX,A.clientY)}else{if(r===q.PAN&&!p.noPan){c=t=p.getMouseOnScreen(A.clientX,A.clientY)}}}document.addEventListener("mousemove",v,false);document.addEventListener("mouseup",o,false)}function v(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();if(r===q.ROTATE&&!p.noRotate){h=p.getMouseProjectionOnBall(A.clientX,A.clientY)}else{if(r===q.ZOOM&&!p.noZoom){u=p.getMouseOnScreen(A.clientX,A.clientY)}else{if(r===q.PAN&&!p.noPan){t=p.getMouseOnScreen(A.clientX,A.clientY)}}}}function o(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();r=q.NONE;document.removeEventListener("mousemove",v);document.removeEventListener("mouseup",o)}function l(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();var B=0;if(A.wheelDelta){B=A.wheelDelta/40}else{if(A.detail){B=-A.detail/3}}j.y+=B*0.01}function s(C){if(p.enabled===false){return}switch(C.touches.length){case 1:r=q.TOUCH_ROTATE;n=h=p.getMouseProjectionOnBall(C.touches[0].pageX,C.touches[0].pageY);break;case 2:r=q.TOUCH_ZOOM;var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;b=g=Math.sqrt(B*B+A*A);break;case 3:r=q.TOUCH_PAN;c=t=p.getMouseOnScreen(C.touches[0].pageX,C.touches[0].pageY);break;default:r=q.NONE}}function e(C){if(p.enabled===false){return}C.preventDefault();C.stopPropagation();switch(C.touches.length){case 1:h=p.getMouseProjectionOnBall(C.touches[0].pageX,C.touches[0].pageY);break;case 2:var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;b=Math.sqrt(B*B+A*A);break;case 3:t=p.getMouseOnScreen(C.touches[0].pageX,C.touches[0].pageY);break;default:r=q.NONE}}function w(A){if(p.enabled===false){return}switch(A.touches.length){case 1:n=h=p.getMouseProjectionOnBall(A.touches[0].pageX,A.touches[0].pageY);break;case 2:g=b=0;break;case 3:c=t=p.getMouseOnScreen(A.touches[0].pageX,A.touches[0].pageY);break}r=q.NONE}this.domElement.addEventListener("contextmenu",function(A){A.preventDefault()},false);this.domElement.addEventListener("mousedown",m,false);this.domElement.addEventListener("mousewheel",l,false);this.domElement.addEventListener("DOMMouseScroll",l,false);this.domElement.addEventListener("touchstart",s,false);this.domElement.addEventListener("touchend",w,false);this.domElement.addEventListener("touchmove",e,false);window.addEventListener("keydown",f,false);window.addEventListener("keyup",d,false);this.handleResize()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);